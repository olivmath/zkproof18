<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK Age Proof</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Game of Life Canvas */
        #gameOfLife {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.15;
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 40px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: 3px;
        }
        
        .tagline {
            font-size: 12px;
            color: #666666;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        /* Main content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Cards */
        .card {
            background: #111111;
            border: 1px solid #333333;
            border-radius: 4px;
            padding: 24px;
            transition: all 0.2s ease;
        }
        
        .card:hover {
            border-color: #ffffff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 12px;
        }
        
        .card-description {
            font-size: 14px;
            color: #888888;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            background: #ffffff;
            color: #000000;
            border: none;
            border-radius: 4px;
            padding: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            background: #cccccc;
        }
        
        .btn:disabled {
            background: #333333;
            color: #666666;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: transparent;
            color: #ffffff;
            border: 1px solid #ffffff;
        }
        
        .btn-secondary:hover {
            background: #ffffff;
            color: #000000;
        }
        
        /* Input styles */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            font-size: 12px;
            color: #ffffff;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .input-field {
            width: 100%;
            background: #000000;
            border: 1px solid #333333;
            border-radius: 4px;
            padding: 16px;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #ffffff;
        }
        
        /* Wallet section */
        .wallet-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: #000000;
            border: 1px solid #333333;
            border-radius: 4px;
        }
        
        .wallet-indicator {
            width: 8px;
            height: 8px;
            background: #ffffff;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .wallet-address {
            font-size: 12px;
            color: #888888;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Action selector */
        .action-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .action-option {
            background: #111111;
            border: 1px solid #333333;
            border-radius: 4px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .action-option:hover {
            border-color: #ffffff;
        }
        
        .action-option.selected {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
        }
        
        .action-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .action-desc {
            font-size: 12px;
            color: #888888;
        }
        
        .action-option.selected .action-desc {
            color: #666666;
        }
        
        /* Progress bar */
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 2px;
            background: #333333;
            border-radius: 1px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #ffffff;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            font-size: 12px;
            color: #888888;
            margin-top: 8px;
            text-align: center;
        }
        
        /* QR Code section */
        .qr-section {
            text-align: center;
            padding: 20px 0;
        }
        
        .qr-code {
            width: 200px;
            height: 200px;
            background: #ffffff;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #000000;
            border-radius: 4px;
        }
        
        .proof-link {
            font-size: 12px;
            color: #888888;
            word-break: break-all;
            margin-bottom: 20px;
        }
        
        /* Hidden class */
        .hidden {
            display: none !important;
        }
        
        /* Ticket/Ingresso Style */
        .ticket {
            background: #ffffff;
            color: #000000;
            border-radius: 8px;
            padding: 24px;
            margin: 20px 0;
            position: relative;
            overflow: visible;
        }
        
        .ticket::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: #000000;
            border-radius: 50%;
        }
        
        .ticket::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: #000000;
            border-radius: 50%;
        }
        
        .ticket-border {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px dashed #000000;
            border-radius: 8px;
            pointer-events: none;
        }
        
        .ticket-border::before {
            content: '';
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            background: #000000;
            border-radius: 50%;
        }
        
        .ticket-border::after {
            content: '';
            position: absolute;
            right: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            background: #000000;
            border-radius: 50%;
        }
        
        .ticket-header {
            text-align: center;
            border-bottom: 1px dashed #000000;
            padding-bottom: 16px;
            margin-bottom: 16px;
        }
        
        .ticket-title {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 4px;
        }
        
        .ticket-subtitle {
            font-size: 12px;
            color: #666666;
            letter-spacing: 1px;
        }
        
        .ticket-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ticket-info {
            flex: 1;
        }
        
        .ticket-label {
            font-size: 10px;
            color: #666666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }
        
        .ticket-value {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
        }
        
        .check-icon {
            width: 60px;
            height: 60px;
            background: #10b981;
            color: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        /* Camera styles */
        .camera-container {
            position: relative;
            margin: 20px 0;
        }
        
        .camera-view {
            width: 100%;
            height: 200px;
            background: #111111;
            border: 1px solid #333333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888888;
            font-size: 14px;
        }
        
        .camera-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            border: 2px solid #ffffff;
            border-radius: 8px;
            pointer-events: none;
        }
        
        .camera-overlay::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            border: 2px solid #ffffff;
            border-radius: 8px;
            animation: scanLine 2s infinite;
        }
        
        @keyframes scanLine {
            0% { border-color: #ffffff transparent transparent transparent; }
            25% { border-color: transparent #ffffff transparent transparent; }
            50% { border-color: transparent transparent #ffffff transparent; }
            75% { border-color: transparent transparent transparent #ffffff; }
            100% { border-color: #ffffff transparent transparent transparent; }
        }
        
        .camera-instructions {
            text-align: center;
            font-size: 12px;
            color: #888888;
            margin-top: 12px;
        }
        
        /* Verify proof input */
        .verify-input {
            margin-bottom: 20px;
        }
        
        .verify-result {
            padding: 16px;
            border-radius: 4px;
            margin-top: 16px;
            font-size: 14px;
        }
        
        .verify-result.success {
            background: #111111;
            border: 1px solid #ffffff;
            color: #ffffff;
        }
        
        .verify-result.error {
            background: #111111;
            border: 1px solid #666666;
            color: #888888;
        }
    </style>
</head>
<body>
    <canvas id="gameOfLife"></canvas>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">ZK_AGE_PROOF</div>
            <div class="tagline">Zero Knowledge Identity</div>
        </div>
        
        <!-- Login Screen -->
        <div class="main-content" id="loginScreen">
            <div class="card">
                <div class="card-title">Connect TON Wallet</div>
                <div class="card-description">
                    Connect your TON wallet to generate or verify zero-knowledge age proofs. Your private keys never leave your device.
                </div>
                <button class="btn" id="connectWalletBtn">Connect TON Wallet</button>
            </div>
        </div>
        
        <!-- Main App -->
        <div class="main-content hidden" id="mainApp">
            <!-- Wallet Status -->
            <div class="wallet-status">
                <div class="wallet-indicator"></div>
                <div>
                    <div style="font-size: 12px;">TON WALLET CONNECTED</div>
                    <div class="wallet-address" id="walletAddress">UQA...7x2f</div>
                </div>
            </div>
            
            <!-- Action Selector -->
            <div class="action-selector">
                <div class="action-option selected" id="generateOption">
                    <div class="action-title">GENERATE</div>
                    <div class="action-desc">Create new proof</div>
                </div>
                <div class="action-option" id="verifyOption">
                    <div class="action-title">VERIFY</div>
                    <div class="action-desc">Validate existing proof</div>
                </div>
            </div>
            
            <!-- Generate Proof Section -->
            <div id="generateSection">
                <div class="card">
                    <div class="card-title">Generate Age Proof</div>
                    <div class="card-description">
                        Prove you're 18+ without revealing your actual age or birth date.
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label" for="birthDate">Birth Date</label>
                        <input type="date" id="birthDate" class="input-field">
                    </div>
                    
                    <button class="btn" id="generateProofBtn">Generate ZK Proof</button>
                    
                    <div class="progress-container hidden" id="generateProgress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="generateProgressFill"></div>
                        </div>
                        <div class="progress-text" id="generateProgressText">Generating proof...</div>
                    </div>
                </div>
            </div>
            
            <!-- Verify Proof Section -->
            <div id="verifySection" class="hidden">
                <div class="card">
                    <div class="card-title">Verify Age Proof</div>
                    <div class="card-description">
                        Point camera at QR code to verify a zero-knowledge age proof.
                    </div>
                    
                    <button class="btn" id="startCameraBtn">Start Camera</button>
                    
                    <div class="camera-container hidden" id="cameraContainer">
                        <div class="camera-view" id="cameraView">
                            <video id="cameraVideo" style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                            <div id="cameraPlaceholder">Camera loading...</div>
                        </div>
                        <div class="camera-overlay"></div>
                        <div class="camera-instructions">
                            Position QR code within the frame to verify proof
                        </div>
                    </div>
                    
                    <div id="verifyResult"></div>
                </div>
            </div>
            
            <!-- Success Section -->
            <div id="successSection" class="hidden">
                <div class="card">
                    <div class="ticket">
                        <div class="ticket-border"></div>
                        <div class="ticket-header">
                            <div class="ticket-title">AGE VERIFIED</div>
                            <div class="ticket-subtitle">Zero Knowledge Proof</div>
                        </div>
                        <div class="ticket-body">
                            <div class="ticket-info">
                                <div class="ticket-label">Wallet</div>
                                <div class="ticket-value" id="ticketWallet">UQB...7x2f</div>
                                
                                <div class="ticket-label">Nullifier</div>
                                <div class="ticket-value" id="ticketNullifier">0x1234...abcd</div>
                                
                                <div class="ticket-label">Verified</div>
                                <div class="ticket-value" id="ticketDate">2025-07-28</div>
                            </div>
                            <div class="check-icon">✓</div>
                        </div>
                    </div>
                    
                    <div class="qr-section">
                        <div class="qr-code" id="qrCode">
                            <div>QR CODE<br/>PLACEHOLDER</div>
                        </div>
                        <div class="proof-link" id="proofLink">
                            https://zkverify.io/proof/0x1234...abcd
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" id="addToWalletBtn">Add to Wallet</button>
                    <button class="btn btn-secondary" id="shareProofBtn" style="margin-top: 12px;">Copy Proof Data</button>
                    <button class="btn" id="newProofBtn" style="margin-top: 12px;">Generate Another Proof</button>
                </div>
            </div>
            
            <!-- Verify Success Section -->
            <div id="verifySuccessSection" class="hidden">
                <div class="card">
                    <div class="ticket">
                        <div class="ticket-border"></div>
                        <div class="ticket-header">
                            <div class="ticket-title">PROOF VERIFIED</div>
                            <div class="ticket-subtitle">Valid Age Confirmation</div>
                        </div>
                        <div class="ticket-body">
                            <div class="ticket-info">
                                <div class="ticket-label">Status</div>
                                <div class="ticket-value">18+ CONFIRMED</div>
                                
                                <div class="ticket-label">Nullifier</div>
                                <div class="ticket-value" id="verifyTicketNullifier">0x5678...efgh</div>
                                
                                <div class="ticket-label">Verified On</div>
                                <div class="ticket-value" id="verifyTicketDate">2025-07-28</div>
                            </div>
                            <div class="check-icon">✓</div>
                        </div>
                    </div>
                    
                    <button class="btn" id="verifyAnotherBtn">Verify Another Proof</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Game of Life implementation
        class GameOfLife {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.cellSize = 8;
                this.cols = Math.ceil(window.innerWidth / this.cellSize);
                this.rows = Math.ceil(window.innerHeight / this.cellSize);
                
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                
                this.grid = this.createGrid();
                this.randomizeGrid();
                
                this.animate();
            }
            
            createGrid() {
                return Array(this.rows).fill().map(() => Array(this.cols).fill(0));
            }
            
            randomizeGrid() {
                for (let row = 0; row < this.rows; row++) {
                    for (let col = 0; col < this.cols; col++) {
                        this.grid[row][col] = Math.random() > 0.8 ? 1 : 0;
                    }
                }
            }
            
            countNeighbors(grid, x, y) {
                let count = 0;
                for (let i = -1; i < 2; i++) {
                    for (let j = -1; j < 2; j++) {
                        if (i === 0 && j === 0) continue;
                        
                        let row = (x + i + this.rows) % this.rows;
                        let col = (y + j + this.cols) % this.cols;
                        count += grid[row][col];
                    }
                }
                return count;
            }
            
            nextGeneration() {
                const newGrid = this.createGrid();
                
                for (let row = 0; row < this.rows; row++) {
                    for (let col = 0; col < this.cols; col++) {
                        const neighbors = this.countNeighbors(this.grid, row, col);
                        const current = this.grid[row][col];
                        
                        if (current === 1 && (neighbors === 2 || neighbors === 3)) {
                            newGrid[row][col] = 1;
                        } else if (current === 0 && neighbors === 3) {
                            newGrid[row][col] = 1;
                        }
                    }
                }
                
                this.grid = newGrid;
            }
            
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.fillStyle = '#ffffff';
                
                for (let row = 0; row < this.rows; row++) {
                    for (let col = 0; col < this.cols; col++) {
                        if (this.grid[row][col] === 1) {
                            this.ctx.fillRect(
                                col * this.cellSize,
                                row * this.cellSize,
                                this.cellSize - 1,
                                this.cellSize - 1
                            );
                        }
                    }
                }
            }
            
            animate() {
                this.draw();
                this.nextGeneration();
                setTimeout(() => this.animate(), 200);
            }
        }
        
        // Initialize Game of Life
        const canvas = document.getElementById('gameOfLife');
        new GameOfLife(canvas);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('gameOfLife');
            new GameOfLife(canvas);
        });
        
        // App state
        let isWalletConnected = false;
        let currentAction = 'generate';
        
        // DOM elements
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const generateOption = document.getElementById('generateOption');
        const verifyOption = document.getElementById('verifyOption');
        const generateSection = document.getElementById('generateSection');
        const verifySection = document.getElementById('verifySection');
        const generateProofBtn = document.getElementById('generateProofBtn');
        const startCameraBtn = document.getElementById('startCameraBtn');
        const birthDateInput = document.getElementById('birthDate');
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const successSection = document.getElementById('successSection');
        const verifySuccessSection = document.getElementById('verifySuccessSection');
        const newProofBtn = document.getElementById('newProofBtn');
        const shareProofBtn = document.getElementById('shareProofBtn');
        const verifyAnotherBtn = document.getElementById('verifyAnotherBtn');
        const addToWalletBtn = document.getElementById('addToWalletBtn');
        const cameraContainer = document.getElementById('cameraContainer');
        const cameraVideo = document.getElementById('cameraVideo');
        const cameraPlaceholder = document.getElementById('cameraPlaceholder');
        
        // Event listeners
        connectWalletBtn.addEventListener('click', connectWallet);
        generateOption.addEventListener('click', () => selectAction('generate'));
        verifyOption.addEventListener('click', () => selectAction('verify'));
        generateProofBtn.addEventListener('click', generateProof);
        startCameraBtn.addEventListener('click', startCamera);
        newProofBtn.addEventListener('click', resetToMain);
        shareProofBtn.addEventListener('click', shareProof);
        addToWalletBtn.addEventListener('click', addToWallet);
        verifyAnotherBtn.addEventListener('click', resetToVerify);
        
        function connectWallet() {
            connectWalletBtn.textContent = 'CONNECTING...';
            connectWalletBtn.disabled = true;
            
            // Simulate TON wallet connection
            setTimeout(() => {
                isWalletConnected = true;
                loginScreen.classList.add('hidden');
                mainApp.classList.remove('hidden');
                
                // Set mock wallet address
                document.getElementById('walletAddress').textContent = 'UQB...7x2f';
            }, 2000);
        }
        
        function selectAction(action) {
            currentAction = action;
            
            // Update UI
            generateOption.classList.toggle('selected', action === 'generate');
            verifyOption.classList.toggle('selected', action === 'verify');
            generateSection.classList.toggle('hidden', action !== 'generate');
            verifySection.classList.toggle('hidden', action !== 'verify');
        }
        
        function generateProof() {
            const birthDate = birthDateInput.value;
            if (!birthDate) {
                alert('Please enter your birth date');
                return;
            }
            
            // Check age
            const birth = new Date(birthDate);
            const today = new Date();
            const age = today.getFullYear() - birth.getFullYear();
            
            if (age < 18) {
                alert('You must be at least 18 years old');
                return;
            }
            
            // Show progress
            document.getElementById('generateProgress').classList.remove('hidden');
            generateProofBtn.disabled = true;
            generateProofBtn.textContent = 'GENERATING...';
            
            // Simulate proof generation
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) progress = 100;
                
                document.getElementById('generateProgressFill').style.width = progress + '%';
                
                if (progress < 30) {
                    document.getElementById('generateProgressText').textContent = 'Deriving wallet secret...';
                } else if (progress < 60) {
                    document.getElementById('generateProgressText').textContent = 'Generating nullifier...';
                } else if (progress < 90) {
                    document.getElementById('generateProgressText').textContent = 'Computing ZK proof...';
                } else {
                    document.getElementById('generateProgressText').textContent = 'Verifying on ZKVerify...';
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    showSuccess();
                }
            }, 200);
        }
        
        function showSuccess() {
            generateSection.classList.add('hidden');
            successSection.classList.remove('hidden');
            
            // Simulate ticket data
            const mockNullifier = '0x' + Array.from({length: 8}, () => Math.floor(Math.random() * 16).toString(16)).join('') + '...abcd';
            const mockProofHash = '0x' + Array.from({length: 64}, () => Math.floor(Math.random() * 16).toString(16)).join('');
            const proofUrl = `https://zkverify.io/proof/${mockProofHash}`;
            const currentDate = new Date().toISOString().split('T')[0];
            
            // Update ticket info
            document.getElementById('ticketWallet').textContent = document.getElementById('walletAddress').textContent;
            document.getElementById('ticketNullifier').textContent = mockNullifier;
            document.getElementById('ticketDate').textContent = currentDate;
            document.getElementById('proofLink').textContent = proofUrl;
            
            // Simple QR code placeholder
            document.getElementById('qrCode').innerHTML = `
                <div style="font-size: 10px; text-align: center;">
                    QR CODE<br/>
                    ${proofUrl.substring(0, 20)}...<br/>
                    <small>Scan to view proof</small>
                </div>
            `;
        }
        
        function startCamera() {
            startCameraBtn.textContent = 'STARTING...';
            startCameraBtn.disabled = true;
            cameraContainer.classList.remove('hidden');
            
            // Simulate camera access
            setTimeout(() => {
                cameraPlaceholder.textContent = 'Camera active - Point at QR code';
                
                // Simulate QR code detection after 3 seconds
                setTimeout(() => {
                    simulateQRScan();
                }, 3000);
            }, 1000);
        }
        
        function simulateQRScan() {
            cameraPlaceholder.textContent = 'QR Code detected! Verifying...';
            
            setTimeout(() => {
                showVerifySuccess();
            }, 2000);
        }
        
        function showVerifySuccess() {
            verifySection.classList.add('hidden');
            verifySuccessSection.classList.remove('hidden');
            
            // Update verification ticket
            const mockNullifier = '0x' + Array.from({length: 8}, () => Math.floor(Math.random() * 16).toString(16)).join('') + '...efgh';
            const currentDate = new Date().toISOString().split('T')[0];
            
            document.getElementById('verifyTicketNullifier').textContent = mockNullifier;
            document.getElementById('verifyTicketDate').textContent = currentDate;
        }
        
        function resetToVerify() {
            verifySuccessSection.classList.add('hidden');
            verifySection.classList.remove('hidden');
            
            // Reset camera
            cameraContainer.classList.add('hidden');
            startCameraBtn.disabled = false;
            startCameraBtn.textContent = 'START CAMERA';
            cameraPlaceholder.textContent = 'Camera loading...';
        }
        
        function addToWallet() {
            // Detect if device supports wallet features
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            if (isIOS) {
                addToAppleWallet();
            } else if (isAndroid) {
                addToGoogleWallet();
            } else {
                alert('Wallet integration not supported on this device');
            }
        }
        
        function addToAppleWallet() {
            // Apple Wallet Pass structure
            const passData = {
                description: 'ZK Age Proof Credential',
                formatVersion: 1,
                organizationName: 'ZK Age Proof',
                passTypeIdentifier: 'pass.zkageproof.credential',
                serialNumber: document.getElementById('ticketNullifier').textContent,
                teamIdentifier: 'YOUR_TEAM_ID',
                
                // Visual appearance
                backgroundColor: 'rgb(0, 0, 0)',
                foregroundColor: 'rgb(255, 255, 255)',
                labelColor: 'rgb(136, 146, 176)',
                
                // Pass structure
                generic: {
                    primaryFields: [
                        {
                            key: 'status',
                            label: 'STATUS',
                            value: 'AGE VERIFIED'
                        }
                    ],
                    secondaryFields: [
                        {
                            key: 'wallet',
                            label: 'WALLET',
                            value: document.getElementById('ticketWallet').textContent
                        },
                        {
                            key: 'date',
                            label: 'VERIFIED',
                            value: document.getElementById('ticketDate').textContent
                        }
                    ],
                    auxiliaryFields: [
                        {
                            key: 'nullifier',
                            label: 'NULLIFIER',
                            value: document.getElementById('ticketNullifier').textContent
                        }
                    ],
                    backFields: [
                        {
                            key: 'description',
                            label: 'ABOUT',
                            value: 'This pass verifies that the holder is 18+ years old using zero-knowledge cryptographic proof. No personal information is stored or transmitted.'
                        },
                        {
                            key: 'proof_link',
                            label: 'VERIFICATION',
                            value: document.getElementById('proofLink').textContent
                        }
                    ]
                },
                
                // Barcode for verification
                barcodes: [
                    {
                        message: document.getElementById('proofLink').textContent,
                        format: 'PKBarcodeFormatQR',
                        messageEncoding: 'iso-8859-1'
                    }
                ]
            };
            
            // In a real implementation, you'd need to:
            // 1. Send this data to your server
            // 2. Generate a signed .pkpass file
            // 3. Return the file URL
            // 4. Trigger download
            
            // For demo purposes:
            addToWalletBtn.textContent = 'ADDED TO WALLET ✓';
            addToWalletBtn.disabled = true;
            
            // Simulate the Apple Wallet add process
            setTimeout(() => {
                alert('Pass would be added to Apple Wallet in production. You would need Apple Developer certificates and a backend to sign the pass.');
            }, 500);
        }
        
        function addToGoogleWallet() {
            // Google Wallet Pass structure
            const passData = {
                iss: 'your-service-account-email@your-project.iam.gserviceaccount.com',
                aud: 'google',
                typ: 'savetowallet',
                
                payload: {
                    genericObjects: [
                        {
                            id: `zkageproof.${Date.now()}`,
                            classId: 'zkageproof.age_verification_class',
                            
                            // Visual design
                            logo: {
                                sourceUri: {
                                    uri: 'https://your-domain.com/logo.png'
                                }
                            },
                            cardTitle: {
                                defaultValue: {
                                    language: 'en',
                                    value: 'Age Verification'
                                }
                            },
                            subheader: {
                                defaultValue: {
                                    language: 'en',
                                    value: 'Zero Knowledge Proof'
                                }
                            },
                            header: {
                                defaultValue: {
                                    language: 'en',
                                    value: 'AGE VERIFIED'
                                }
                            },
                            
                            // Pass content
                            textModulesData: [
                                {
                                    id: 'wallet',
                                    header: 'WALLET',
                                    body: document.getElementById('ticketWallet').textContent
                                },
                                {
                                    id: 'nullifier',
                                    header: 'NULLIFIER',
                                    body: document.getElementById('ticketNullifier').textContent
                                },
                                {
                                    id: 'verified_date',
                                    header: 'VERIFIED',
                                    body: document.getElementById('ticketDate').textContent
                                }
                            ],
                            
                            // Barcode
                            barcode: {
                                type: 'QR_CODE',
                                value: document.getElementById('proofLink').textContent
                            },
                            
                            // Colors
                            hexBackgroundColor: '#000000',
                            
                            // State
                            state: 'ACTIVE'
                        }
                    ]
                }
            };
            
            // In a real implementation, you'd need to:
            // 1. Sign this JWT with your Google service account key
            // 2. Create the "Add to Google Wallet" link
            // 3. Open the link or redirect user
            
            // For demo purposes:
            addToWalletBtn.textContent = 'ADDED TO WALLET ✓';
            addToWalletBtn.disabled = true;
            
            setTimeout(() => {
                alert('Pass would be added to Google Wallet in production. You would need Google service account credentials and JWT signing.');
            }, 500);
        }
        
        function shareProof() {
            const mockProof = {
                proof: "0x" + Array.from({length: 128}, () => Math.floor(Math.random() * 16).toString(16)).join(''),
                nullifier: "0x" + Array.from({length: 64}, () => Math.floor(Math.random() * 16).toString(16)).join(''),
                timestamp: Date.now(),
                verified: true
            };
            
            navigator.clipboard.writeText(JSON.stringify(mockProof, null, 2));
            shareProofBtn.textContent = 'COPIED!';
            setTimeout(() => {
                shareProofBtn.textContent = 'COPY PROOF DATA';
            }, 2000);
        }
        
        function resetToMain() {
            successSection.classList.add('hidden');
            generateSection.classList.remove('hidden');
            
            // Reset form
            birthDateInput.value = '';
            generateProofBtn.disabled = false;
            generateProofBtn.textContent = 'GENERATE ZK PROOF';
            document.getElementById('generateProgress').classList.add('hidden');
            document.getElementById('generateProgressFill').style.width = '0%';
        }
        
        // Set max date to 18 years ago
        const eighteenYearsAgo = new Date();
        eighteenYearsAgo.setFullYear(eighteenYearsAgo.getFullYear() - 18);
        document.getElementById('birthDate').max = eighteenYearsAgo.toISOString().split('T')[0];
    </script>
</body>
</html>